<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Experimental Robotics Laboratory second assignment: Experimental Robotics Laboratory - Assignment 2</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Experimental Robotics Laboratory second assignment
   </div>
   <div id="projectbrief">Second Assignment for the Experimental Robotics Laboratory course in the Robotics master degree at UNIGE.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Experimental Robotics Laboratory - Assignment 2 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md1"></a>
Jacopo Ciro Soncini 5050695</h1>
<p>E-mail: <a href="#" onclick="location.href='mai'+'lto:'+'jac'+'op'+'o.s'+'on'+'cin'+'i@'+'gma'+'il'+'.co'+'m'; return false;">jacop<span style="display: none;">.nosp@m.</span>o.so<span style="display: none;">.nosp@m.</span>ncini<span style="display: none;">.nosp@m.</span>@gma<span style="display: none;">.nosp@m.</span>il.co<span style="display: none;">.nosp@m.</span>m</a></p>
<h1><a class="anchor" id="autotoc_md2"></a>
Brief introduction</h1>
<p>The project implements a game of cluedo. In this project the simulation is a simple room with 4 points to collect the hints, the behaviour is handled with a ROSplan and the actions have a meaning in the physical world. The robot collects hints and sends them to the armor service that returns any complete hypothesis. Then the robot return home and checks if the hypothesis is correct. In this implemenation hint can be malformed and building an incosistent hypothesis is possible.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Preliminary actions</h1>
<p>The package is containing the onthology used by the SherlockBot, but it will need to be paired with the Armor package Professor Luca Buoncompagni and Alessio Capitanelli developed, downloadable at <a href="https://github.com/EmaroLab/armor">https://github.com/EmaroLab/armor</a>. To run this package you will also need to download the ROSPlan package at <a href="https://github.com/KCL-Planning/ROSPlan.git">https://github.com/KCL-Planning/ROSPlan.git</a> . Lastly you will need to download my moveit package at <a href="https://github.com/jacopociro/moveit.git">https://github.com/jacopociro/moveit.git</a></p>
<h1><a class="anchor" id="autotoc_md4"></a>
Software Architecture</h1>
<p>SherlockBot is handled with ROSPlan and 10 nodes that handle hints, hypothesis, the oracle and the actions. The plan.py handles the various part of ROSplan, updating the knowledge as requested. More on the system architecture to be explained with the graphs, first I will explain the contents of the package. The package is composed of:</p><ul>
<li>One action file:<ul>
<li>Move.action</li>
</ul>
</li>
<li>Two config files:<ul>
<li>motors_config.yaml</li>
<li>sim.rviz</li>
</ul>
</li>
<li>four launch files:+<ul>
<li>assignment.launch</li>
<li>launch.launch</li>
<li>plan.launch</li>
<li>spawn.launch</li>
</ul>
</li>
<li>Two custom message file:<ul>
<li>ErlOracle.msg</li>
<li>Hyp.msg</li>
</ul>
</li>
<li>Two custom service files:<ul>
<li>Hypothesis.srv</li>
<li>Oracle.srv</li>
</ul>
</li>
<li>PDDL plan:<ul>
<li>auto_problem.pddl</li>
<li>domain.pddl</li>
<li>plan.pddl</li>
<li>problem.pddl</li>
</ul>
</li>
<li>ten nodes:<ul>
<li>go_to_point_action.py</li>
<li><a class="el" href="hypothesis__maker_8py.html" title="This script handles the hypothesis maker service and the onthology part.">hypothesis_maker.py</a></li>
<li>plan.py</li>
<li><a class="el" href="add__to__onthology_8cpp.html" title="implements the add_to_onthology action">add_to_onthology.cpp</a></li>
<li><a class="el" href="check__oracle_8cpp.html" title="implements the check_oracle action">check_oracle.cpp</a></li>
<li>got_to_waypoint.cpp</li>
<li><a class="el" href="hypothesis__check_8cpp.html" title="implements the hypothesis_check action">hypothesis_check.cpp</a></li>
<li><a class="el" href="leave__home_8cpp.html" title="implements the leave_home action">leave_home.cpp</a></li>
<li><a class="el" href="return__home_8cpp.html" title="implements the return_home action">return_home.cpp</a></li>
<li><a class="el" href="simulation_8cpp.html" title="implements the simulation for the assignment">simulation.cpp</a></li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md5"></a>
Custom messages and services</h2>
<h3><a class="anchor" id="autotoc_md6"></a>
ErlOracle message</h3>
<p>The message is composed of one int32: id and two strings: name and class. These are needed to be readable from armor service and upload them correctly on the onthology.</p>
<p>&gt;int32 id</p>
<p>&gt;string name</p>
<p>&gt;string class_id</p>
<h3><a class="anchor" id="autotoc_md7"></a>
Hypothesis service</h3>
<p>The request has the same format as the Hint message. The response is composed of 3 strings (id, who, what, where) and 1 boolean value (consistent). This service is called every time i upload one hint and return any complete hint, with a boolean value that checks if it is consistent. <b>Request</b> &gt;string id</p>
<p>&gt;string name</p>
<p>&gt;string class_id</p>
<p><b>Response</b> &gt;string id</p>
<p>&gt;string who</p>
<p>&gt;string where</p>
<p>&gt;string what</p>
<p>&gt;bool consistent</p>
<h3><a class="anchor" id="autotoc_md8"></a>
oracle service</h3>
<p>The request is a string with the id of the hypotesis. The response is an int32 value that checks if the hypothesis is correct. <b>Request</b> &gt;string id</p>
<p><b>Response</b> &gt;int32 right</p>
<h2><a class="anchor" id="autotoc_md9"></a>
PDDL</h2>
<h3><a class="anchor" id="autotoc_md10"></a>
Domain</h3>
<h3><a class="anchor" id="autotoc_md11"></a>
Problem</h3>
<h3><a class="anchor" id="autotoc_md12"></a>
Plan</h3>
<h2><a class="anchor" id="autotoc_md13"></a>
Nodes</h2>
<h3><a class="anchor" id="autotoc_md14"></a>
hint_publisher.py</h3>
<p>This node generates random hint from an array of hints and, using a ROS publisher, sends them to whoever subscribes. There are 18 different hint divided in 6 identifiers, each one is consistent. </p>
<h3><a class="anchor" id="autotoc_md15"></a>
hypothesis_maker.py</h3>
<p>This node is the one tasked with communicating with the armor service and updating the onthology. It receives the hints and adds them to the onthology, then it checks if there is a complete hypothesis. In case there is it returns the complete hypothesis, otherwise is returns an empty message. </p>
<h3><a class="anchor" id="autotoc_md16"></a>
oracle_service.py</h3>
<p>This node is tasked with checking if the complete hypothesis is the correct one. It does so by simply checking if the hypotesis' id is "HP3" or whatever the user sets. </p>
<h3><a class="anchor" id="autotoc_md17"></a>
state_machine.py</h3>
<p>This node is the central node and handles the behaviour of the robot, basing it off of states. There are 3 states: move, clues and hyp. The first one handles the movement of the robot to a random room, the second one collects hints and the last one checks if the hypothesis formulated is correct. </p>
<h2><a class="anchor" id="autotoc_md18"></a>
Architecture diagram</h2>
<p><img src="images/exp_rob1.jpg" alt="System Architecture" class="inline"/></p>
<p><img src="images/rosgraph.png" alt="Rqt Graph" class="inline"/></p>
<p>As we can see the architecture is composed of 5 nodes. The central one is the state machine, which subscribes to the hint publisher and call the services in hypothesis_maker and oracle. The hypothesis maker node also call the service in armor, in order to update the cluedo onthology. </p>
<h2><a class="anchor" id="autotoc_md19"></a>
State Machine</h2>
<p><img src="images/sm_sys.GIF" alt="State Machine" class="inline"/></p>
<p>The state machine has 3 states: move, clues and hyp. The machine starts in the move state, from which will move to the clues state. The clues state has two possible outputs, based on if the received hypothesis is complete or not. If the hypothesis is complete then it will go to the hyp state, to check if it is correct. Otherwise the machine will return to the move state to collect more hints. The hyp state has two outcomes, if the hypothesis is correct then the game ends, otherwise the machine returns to the move state, to collect more hints. </p>
<h2><a class="anchor" id="autotoc_md20"></a>
Temporal sequence diagram</h2>
<p><img src="images/exp_rob1_seq.jpg" alt="System Architecture" class="inline"/></p>
<p>This image shows a temporal sequence diagram for the simulation, in case every output is ok at the first run. Probably the state machine will be called again and again but the number of times is not fixed, so it is not represented. The state machine starts with the move state, making the robot move to a clue. Then, when it changes to the clues state the robot subscribes to a publisher and reads the hint. In this state, but at a different time, it also calls the hypothesis maker service, to add the hint to the onthology and then it checks for a complete hypothesis. Assuming the hypothesis is complete the robot goes to the oracle state where it moves to the terminal and check if the hypothesis is correct, which if it is will be the last action done. </p>
<h1><a class="anchor" id="autotoc_md21"></a>
Installation and Running Procedure</h1>
<p>To install this package, assuming you have installed the armor package as indicated in the above link (don't forget to run the <code>./gradlew deployApp</code> command in the armor folder), you will need to just clone the github repository in your ros workspace, move to the correct branch and build it. in &lt;your_ros_workspace&gt;/src run: </p><div class="fragment"><div class="line">git clone https://github.com/jacopociro/exp_rob_lab.git</div>
<div class="line">git checkout ass1</div>
<div class="line">cd ..</div>
<div class="line">catkin_make</div>
</div><!-- fragment --><p>When this is done, hopefully with no errors, just run </p><div class="fragment"><div class="line">roslaunch exp_rob_lab launch.launch</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md22"></a>
Running code</h1>
<p>The simulation is really simple, as all of the actions are simulated in this stage. The only output we have is text on the terminal. </p>
<h3><a class="anchor" id="autotoc_md23"></a>
Move state</h3>
<p><img src="images/move%20state.PNG" alt="System Architecture" class="inline"/></p>
<p>This is the move state output, where the robot moves to a random room. </p>
<h3><a class="anchor" id="autotoc_md24"></a>
Clues state</h3>
<p>The robot is now in the clues state where it collects hint and returns the formulated hypothesis This can be incomplete:</p>
<p><img src="images/incomplete%20hyp.PNG" alt="System Architecture" class="inline"/></p>
<p>or complete:</p>
<p><img src="images/complete%20hyp.PNG" alt="System Architecture" class="inline"/></p>
<h3><a class="anchor" id="autotoc_md25"></a>
Oracle state</h3>
<p>THis state checks if the hypothesis is incorrect, in which case returns to the move state:</p>
<p><img src="images/failed.PNG" alt="System Architecture" class="inline"/></p>
<p>or correct, in which case stops the program:</p>
<p><img src="images/Succesfull.PNG" alt="System Architecture" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md26"></a>
Working Hypothesis and Environment</h1>
<p>The environment is as simple as it can be, in order to be easily changed and improved in the next two assignments. In this implementation the enviroment is totally simulated, the robot has a few simulated action that should be able to easily changed into real actions. All of the variable are defined by the author, such as hints and the correct hypothesis. </p>
<h2><a class="anchor" id="autotoc_md27"></a>
System's Features</h2>
<p>The system is easily adaptable to changes, as it is pretty modular and each script handles the different parts of the algorithm. The system can also handle random hints, even though the need to be properly written. If the hint is not proper the system should just ignore them.</p>
<h2><a class="anchor" id="autotoc_md28"></a>
System's Limitations</h2>
<p>The system is not designed to handle malformed hint or to discard incosistent hints. To change the hitns and the solution the user needs to have some programming knowledge. The onthology is not readable when it gets updated. The output is not easy to read. </p>
<h2><a class="anchor" id="autotoc_md29"></a>
Possible Techinical Imporvements</h2>
<p>A good improvment would be the implementation of malformed hints and incosistent hypothesis, to check if the program can handle it. Also it would be good to have easier way to check the output of the various scripts. The last obious improvment would be to have actual action instead of simulated ones </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
